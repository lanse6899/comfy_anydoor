# AnyDoor - ComfyUI 节点 Bypass 控制器插件

AnyDoor 是一个 ComfyUI 插件，用于根据节点编号控制工作流中任意节点的 bypass 状态。

## 功能特性

- ✅ 根据节点编号控制节点的 bypass 状态
- ✅ 支持输入任意节点编号（1-999999）
- ✅ 实时控制：修改节点编号或模式时立即生效
- ✅ 三种模式：正常执行、禁用、Bypass
- ✅ 前端自动处理：通过 JavaScript 实时修改节点状态

## 安装方法

1. 将整个插件文件夹复制到 ComfyUI 的 `custom_nodes` 目录：
   ```
   ComfyUI/custom_nodes/anydoor/
   ```

2. 重启 ComfyUI

## 使用方法

1. **打开 ComfyUI**
2. **添加节点**：在工作流中添加 "控制节点Bypass" 节点（在 "工具/AnyDoor" 分类下）
3. **输入节点编号**：在节点的 "节点编号" 输入框中输入要控制的节点编号（节点ID）
4. **选择模式**：从 "节点模式" 下拉菜单中选择：
   - **正常执行**：节点正常执行（mode=0）
   - **禁用**：节点被禁用，不会执行（mode=1）
   - **Bypass**：节点处于 bypass 状态，跳过执行但保留连接（mode=2）
5. **实时生效**：修改节点编号或模式后，目标节点的状态会立即更新

## 节点模式说明

ComfyUI 节点有以下几种模式：

- **0 - 正常执行**：节点正常执行，处理输入并产生输出
- **1 - 禁用**：节点被禁用，不会执行，不会产生输出
- **2 - Bypass**：节点处于 bypass 状态，会跳过执行但保留连接，使用上一次的输出值（如果有）

## 节点输入

插件节点提供以下输入：

1. **node_id** (INT): 
   - 要控制的节点编号（节点ID）
   - 范围：1-999999
   - 这是工作流中节点的唯一标识符

2. **set_bypass** (选择框):
   - 要设置的节点模式
   - 选项：正常执行、禁用、Bypass

3. **trigger** (INT，可选):
   - 触发控制的标志（0或1）
   - 通常不需要手动设置

## 节点输出

插件节点提供两个输出：

1. **status_info** (STRING):
   - 控制操作的详细状态信息
   - 显示是否成功设置节点状态

2. **mode_value** (INT):
   - 设置的模式值（0, 1, 或 2）

## 工作原理

1. **前端监听**：JavaScript 脚本监听控制节点的值变化
2. **实时更新**：当节点编号或模式改变时，立即查找目标节点并修改其 `mode` 属性
3. **执行前检查**：在工作流执行前，再次检查并应用所有控制节点的设置

## 示例使用场景

### 场景1：动态控制节点执行
```
工作流中有多个处理节点，根据条件动态决定哪些节点执行：
- 节点5：图像预处理
- 节点8：图像增强
- 使用 AnyDoor 节点根据输入条件动态设置节点5和节点8的模式
```

### 场景2：快速测试工作流
```
临时禁用某些节点来测试工作流的其他部分：
- 添加控制节点，输入要禁用的节点编号
- 选择"禁用"模式
- 节点立即被禁用，可以快速测试
```

### 场景3：条件分支处理
```
根据条件决定是否执行某些处理步骤：
- 使用多个 AnyDoor 节点控制不同分支
- 根据输入参数动态切换节点状态
```

## 故障排除

### 节点状态没有改变

1. **检查节点编号**：
   - 确保输入的节点编号正确
   - 在 ComfyUI 界面中，可以查看每个节点的 ID（通常在节点信息中显示）

### 找不到节点

- 确保节点编号与工作流中实际节点的 ID 匹配
- 节点 ID 是数字，不是节点标题或类型名称
- 可以在 ComfyUI 中右键节点查看节点信息来确认节点 ID

## 贡献

欢迎提交 Issue 和 Pull Request！

